import{b as V,d as A,B as m,cU as E,be as g,d$ as J,bv as w,x as e,b_ as j,ap as G,ai as $,S as h,bW as o,bJ as c,L as x,bL as S,bM as y,bO as K,bQ as k,bR as v,W as p,bS as C,bT as _,bU as X,ao as Y,bN as Z,dm as ee,dn as re,dp as te,av as ne,bg as I,Q as se,n as L,bw as d,ea as ae}from"./index-83beb5cc.js";const ie=()=>{const s=V(),{params:R,back:T}=A(),{id:i}=R,[f,D]=m([]),[O,q]=m([]),[t,l]=E({id:0,username:"",password:"",base_path:"",role:[],permission:0,disabled:!1,sso_id:"",role_info:[],permissions:[]}),[F,B]=g(()=>J()),[P,U]=g(()=>w.get(`/admin/user/get?id=${i}`)),z=async()=>{const r=await B();if(d(r,n=>{D(n.content)}),i){const n=await U();d(n,a=>{l(a),H(a.role)})}else l("base_path","/")},H=async r=>{const n=new Set;n.add("/");for(const a of r){const u=await ae(a);d(u,Q=>{for(const b of Q.permission_scopes||[])b.path&&n.add(b.path)})}q([...n].map(a=>a.toString()))};z();const[W,M]=g(()=>w.post(`/admin/user/${i?"update":"create"}`,t)),N=()=>!i;return e($,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(j,{get children(){return s(i?"global.edit":"global.add")}}),e(G,{get loading(){return P()||F()},get children(){return e($,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(h,{get when(){return!i||!(t.role_info||[]).includes(1)},get children(){return[e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"username",display:"flex",alignItems:"center",get children(){return s("users.username")}}),e(x,{id:"username",get value(){return t.username},onInput:r=>l("username",r.currentTarget.value)})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"password",display:"flex",alignItems:"center",get children(){return s("users.password")}}),e(x,{id:"password",type:"password",placeholder:"********",get value(){return t.password},onInput:r=>l("password",r.currentTarget.value)})]}})]}}),e(h,{get when(){return!N()},get children(){return e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"base_path",display:"flex",alignItems:"center",get children(){return s("users.base_path")}}),e(S,{get value(){return t.base_path},onChange:r=>l("base_path",r),get children(){return[e(y,{get children(){return e(K,{})}}),e(k,{get children(){return e(v,{get children(){return e(p,{get each(){return O()},children:r=>e(C,{value:r,get children(){return[e(_,{children:r}),e(X,{})]}})})}})}})]}})]}})}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{display:"flex",alignItems:"center",get children(){return s("users.role")}}),e(S,{get value(){return t.role},onChange:r=>l("role",r),get children(){return[e(y,{get children(){return e(Y,{display:"flex",flexWrap:"wrap",gap:"$2",pr:"$6",py:"$2",minH:"40px",alignItems:"center",get children(){return e(h,{get when(){return t.role.length>0},get fallback(){return e(Z,{get children(){return s("home.selected")}})},get children(){return e(p,{get each(){return t.role},children:r=>{const n=f().find(a=>a.id===r);return e(ee,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(re,{get children(){return(n==null?void 0:n.name)||`ID: ${r}`}}),e(te,{onClick:a=>{a.stopPropagation(),l("role",t.role.filter(u=>u!==r))}})]}})}})}})}})}}),e(k,{get children(){return e(v,{get children(){return e(p,{get each(){return f()},children:r=>e(C,{get value(){return r.id},onClick:()=>{const n=t.role.includes(r.id)?t.role.filter(a=>a!==r.id):[r.id];l("role",n)},get children(){return e(ne,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e(I,{get checked(){return t.role.includes(r.id)},readOnly:!0}),e(_,{get children(){return r.name}})]}})}})})}})}})]}})]}}),e(o,{w:"fit-content",display:"flex",get children(){return e(I,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>l("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return t.disabled},get children(){return s("users.disabled")}})}}),e(se,{get loading(){return W()},onClick:async()=>{if(!t.role||t.role.length===0){L.error(s("users.role")+" "+s("global.required"));return}const r=await M();d(r,()=>{L.success(s("global.save_success")),T()})},get children(){return s("global.save")}})]}})}})]}})};export{ie as default};
