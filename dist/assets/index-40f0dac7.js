import{ct as Ne,V as we,c9 as be,ca as U,az as _e,a7 as Q,x as e,am as m,a1 as $e,S as l,ao as J,an as j,a4 as C,d as Ce,cu as F,cv as L,r as ve,aP as P,bv as I,c7 as Te,cw as Ae,cx as Ue,cy as je,cz as Oe,b as Ve,A as q,B as _,cA as He,be as D,q as ae,cB as Ke,ai as A,av as z,aM as ce,b$ as k,b_ as ge,L as S,bg as ue,ah as R,Q as B,bG as de,bH as pe,cC as he,cD as We,cE as Je,cF as qe,aB as Ze,cG as Qe,cH as Xe,aT as Ye,bw as fe,cI as et,n as $,cJ as Z}from"./index-83beb5cc.js";import{a as tt}from"./useTitle-61b32228.js";import{s as rt,g as nt,a as ot}from"./webauthn-json.browser-ponyfill-f2f06d6e.js";const st="https://github.com/alist-org/alist";function lt(t){return Ne(`${t}-${st}`)}const it=_e('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),at=t=>{const p=we({startColor:"#28aff0",endColor:"#120fc4"},t);return(()=>{const h=it.cloneNode(!0),s=h.firstChild,g=s.firstChild,a=g.nextSibling,i=a.firstChild,u=i.nextSibling;return be(o=>{const c=p.startColor,w=p.endColor;return c!==o._v$&&U(i,"stop-color",o._v$=c),w!==o._v$2&&U(u,"stop-color",o._v$2=w),o},{_v$:void 0,_v$2:void 0}),h})()},ct=_e('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),gt=t=>{const p=we({startColor:"#28aff0",endColor:"#120fc4"},t);return(()=>{const h=ct.cloneNode(!0),s=h.firstChild,g=s.firstChild,a=g.nextSibling,i=a.firstChild,u=i.nextSibling;return be(o=>{const c=p.startColor,w=p.endColor;return c!==o._v$&&U(i,"stop-color",o._v$=c),w!==o._v$2&&U(u,"stop-color",o._v$2=w),o},{_v$:void 0,_v$2:void 0}),h})()},ut=t=>{const p=Q("#a9c6ff","#062b74");return e(J,{get bgColor(){return m(()=>!!t.useNewVersion,!0)()?void 0:p()},get style(){return m(()=>!!t.useNewVersion,!0)()?{"background-image":`url(${$e("/images/new_bg.png")})`,"background-size":"cover","background-position":"center"}:void 0},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return e(l,{get when(){return!t.useNewVersion},get children(){return[e(J,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(gt,{})}}),e(J,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(at,{})}})]}})}})},me=()=>{const t=j("sso_login_enabled"),p=C("sso_login_platform"),h=j("sso_compatibility_mode"),{searchParams:s,to:g}=Ce(),a=s.token;a!=null&&a!=""&&(F(a),g(decodeURIComponent(s.redirect||L||"/"),!0));function i(u){const o=u.data;o.token&&(F(o.token),g(decodeURIComponent(s.redirect||L||"/"),!0))}if(window.addEventListener("message",i),ve(()=>{window.removeEventListener("message",i)}),t){const u=()=>{const c=I.getUri()+"/auth/sso?method=sso_get_token";if(h){window.location.href=c;return}window.open(c,"authPopup","width=500,height=600")};let o;switch(p){case"Github":o=Oe;break;case"Microsoft":o=je;break;case"Google":o=Ue;break;case"Dingtalk":o=Ae;break;default:o=Te}return e(P,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:u})}},mt=()=>{const t=Ve(),p=q(()=>`${t("login.login_to")} ${C("site_title")}`);tt(p);const h=Q("white","$neutral1"),[s,g]=_(localStorage.getItem("username")||""),[a,i]=_(localStorage.getItem("password")||""),[u,o]=_(!1),[c,w]=_(""),[E,xe]=_(!1),[G,ye]=He("remember-pwd","false"),[O,X]=_(!1),[d,Y]=_(!1),V=()=>{if(!d())g(""),i("");else{const r=localStorage.getItem("username")||"",n=localStorage.getItem("password")||"";g(r),i(n)}Y(!d())},[dt,ke]=D(()=>I.get("/public/settings")),Se=async()=>{const r=await ke();fe(r,n=>{et(n)})},H=q(()=>C("use_newui")==="true"),ee=q(()=>C("allow_register")==="true");ae(()=>{Se()});const[te,Ie]=D(async()=>O()?I.post("/auth/login/ldap",{username:s(),password:a(),otp_code:c()}):I.post("/auth/login/hash",{username:s(),password:lt(a()),otp_code:c()})),[re,Fe]=D(async()=>Ke({username:s(),password:a()})),[,Le]=D((r,n,b,W)=>I.post("/authn/webauthn_finish_login?username="+b,JSON.stringify(n),{headers:{session:r},signal:W})),[,Ee]=D((r,n)=>I.get("/authn/webauthn_begin_login?username="+r,{signal:n})),{searchParams:M,to:N}=Ce(),De=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,K=j("webauthn_login_enabled"),ne=async()=>{xe(!E())};let f=null;const oe=async r=>{if(!rt()){r||$.error(t("users.webauthn_not_supported"));return}if(r&&!await De())return;f==null||f.abort();const n=new AbortController;f=n;const b=r?"":s();!r&&G()==="true"?localStorage.setItem("username",s()):localStorage.removeItem("username");const W=await Ee(b,n.signal);fe(W,async ie=>{try{const v=nt(ie.options);v.signal=n.signal,r&&(v.mediation="conditional");const Ge=await ot(v),Me=await Le(ie.session,Ge,b,n.signal);Z(Me,y=>{$.success(t("login.success")),F(y.token),y.device_key?(localStorage.setItem("device_key",y.device_key),console.log("=== Login Debug (Hash) ==="),console.log("Saved device_key:",y.device_key),console.log("Full response data:",y),console.log("========================")):(console.log("=== Login Debug (Hash) ==="),console.log("No device_key in response"),console.log("Full response data:",y),console.log("========================")),N(decodeURIComponent(M.redirect||L||"/"),!0)})}catch(v){v instanceof Error&&v.name!="AbortError"&&$.error(v.message)}})},se=()=>f==null?void 0:f.abort();ae(()=>{K&&(window.addEventListener("beforeunload",se),oe(!0))}),ve(()=>{f==null||f.abort(),window.removeEventListener("beforeunload",se)});const x=async()=>{if(d()){const r=await Fe();Z(r,n=>{$.success(t("login.register_success")),Y(!1),i("")},(n,b)=>{b===403?$.error(t("login.register_disabled")):$.error(n)})}else if(E())await oe();else{G()==="true"?(localStorage.setItem("username",s()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const r=await Ie();Z(r,n=>{$.success(t("login.success")),F(n.token),n.device_key?(localStorage.setItem("device_key",n.device_key),console.log("=== Login Debug ==="),console.log("Saved device_key:",n.device_key),console.log("Full response data:",n),console.log("==================")):(console.log("=== Login Debug ==="),console.log("No device_key in response"),console.log("Full response data:",n),console.log("==================")),N(decodeURIComponent(M.redirect||L||"/"),!0)},(n,b)=>{!T()&&b===402?ze(!0):$.error(n)})}},[T,ze]=_(!1),le=j("ldap_login_enabled"),Re=C("ldap_login_tips");le&&X(!0);const Be=()=>t("login.password_login"),Pe=()=>C("logo").split(`
`)[0];return e(Ye,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(A,{spacing:"$6",alignItems:"center",get children(){return[e(l,{get when(){return H()},get children(){return e(z,{alignItems:"center",spacing:"$2",get children(){return e(ce,{w:"151px",h:"auto",get src(){return m(()=>C("logo").split(`
`)[0]==="https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg",!0)()?$e("/images/new_icon.png"):C("logo").split(`
`)[0]},alt:"AList Logo"})}})}}),e(l,{get when(){return H()},get fallback(){return e(A,{get bgColor(){return h()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(k,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ce,{mr:"$2",boxSize:"$12",get src(){return Pe()}}),e(ge,{color:"$info9",fontSize:"$2xl",get children(){return m(()=>!!d(),!0)()?t("login.register"):Be()}})]}}),e(l,{get when(){return!T()},get fallback(){return e(S,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return c()},onInput:r=>w(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&x()}})},get children(){return[e(S,{name:"username",get placeholder(){return t("login.username-tips")},get value(){return s()},onInput:r=>g(r.currentTarget.value)}),e(l,{get when(){return!E()},get children(){return e(S,{name:"password",get placeholder(){return t("login.password-tips")},type:"password",get value(){return a()},onInput:r=>i(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&x()}})}}),e(k,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(ue,{get checked(){return G()==="true"},onChange:()=>ye(G()==="true"?"false":"true"),get children(){return t("login.remember")}}),e(l,{get when(){return!d()},get children(){return e(R,{as:"a",target:"_blank",get href(){return t("login.forget_url")},get children(){return t("login.forget")}})}}),e(l,{get when(){return d()},get children(){return e(R,{as:"a",onClick:V,cursor:"pointer",_hover:{textDecoration:"underline",color:"#2B5CD9"},color:"#3573FF",get children(){return t("login.go_login")}})}})]}})]}}),e(z,{w:"$full",spacing:"$2",get children(){return[e(l,{get when(){return!E()},get children(){return e(B,{colorScheme:"primary",w:"$full",onClick:()=>{T()?w(""):(g(""),i(""))},get children(){return t("login.clear")}})}}),e(B,{w:"$full",get loading(){return te()||re()},onClick:x,get children(){return m(()=>!!d(),!0)()?t("login.register"):t("login.login")}})]}}),e(l,{when:le,get children(){return e(ue,{w:"$full",get checked(){return O()===!0},onChange:()=>X(!O()),children:Re})}}),e(B,{w:"$full",colorScheme:"accent",onClick:()=>{F(),N(decodeURIComponent(M.redirect||L||"/"),!0)},get children(){return t("login.use_guest")}}),e(l,{get when(){return m(()=>!d(),!0)()&&ee()},get children(){return e(B,{w:"$full",get bgColor(){return Q("#FFE9FB","#491D42")()},color:"#ED73D7",onClick:V,_hover:{backgroundColor:"rgba(237, 115, 215, 0.25)"},get children(){return t("login.register")}})}}),e(k,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(de,{}),e(pe,{}),e(me,{}),e(l,{when:K,get children(){return e(P,{cursor:"pointer",boxSize:"$8",as:he,p:"$0_5",onclick:ne})}})]}})]}})},get children(){return e(A,{get bgColor(){return h()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"420px"},spacing:"$4",get children(){return[e(k,{alignItems:"center",justifyContent:"center",get children(){return e(ge,{color:"#3573FF",fontSize:"18px",get children(){return m(()=>!!d(),!0)()?t("login.register"):t("login.password_login")}})}}),e(We,{borderColor:"#E9E9E9"}),e(l,{get when(){return!T()},get fallback(){return e(S,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return c()},onInput:r=>w(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&x()}})},get children(){return[e(z,{w:"$full",border:"1px solid",borderColor:"$neutral6",borderRadius:"12px",px:"$3",spacing:"$2",alignItems:"center",_focusWithin:{borderColor:"$primary6",boxShadow:"0 0 0 1px $colors$primary6"},get children(){return[e(P,{as:Je,color:"$neutral8",boxSize:"$5"}),e(S,{name:"username",get placeholder(){return t("login.username-tips")},get value(){return s()},onInput:r=>g(r.currentTarget.value),border:"none",backgroundColor:"transparent",_focus:{border:"none",boxShadow:"none",backgroundColor:"transparent"},_hover:{border:"none",boxShadow:"none",backgroundColor:"transparent"},flex:1})]}}),e(l,{get when(){return!E()},get children(){return e(z,{w:"$full",border:"1px solid",borderColor:"$neutral6",borderRadius:"12px",px:"$3",spacing:"$2",alignItems:"center",_focusWithin:{borderColor:"$primary6",boxShadow:"0 0 0 1px $colors$primary6"},get children(){return[e(P,{as:qe,color:"$neutral8",boxSize:"$5"}),e(S,{name:"password",get placeholder(){return t("login.password-tips")},get type(){return u()?"text":"password"},get value(){return a()},onInput:r=>i(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&x()},border:"none",backgroundColor:"transparent",_focus:{border:"none",boxShadow:"none",backgroundColor:"transparent"},_hover:{border:"none",boxShadow:"none",backgroundColor:"transparent"},flex:1}),e(Ze,{size:"md",variant:"ghost",get icon(){return m(()=>!!u(),!0)()?e(Qe,{}):e(Xe,{})},onClick:()=>o(!u()),color:"$neutral8",get"aria-label"(){return u()?"隐藏密码":"显示密码"},_hover:{backgroundColor:"$neutral3"}})]}})}}),e(l,{get when(){return!d()},get children(){return e(k,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"flex-end",alignItems:"center",get children(){return e(R,{as:"a",target:"_blank",get href(){return t("login.forget_url")},get children(){return t("login.forget")}})}})}})]}}),e(A,{w:"$full",spacing:"$4",get children(){return[e(B,{w:"$full",get loading(){return te()||re()},onClick:x,bgColor:"#3573FF",color:"white",_hover:{backgroundColor:"#2B5CD9"},_active:{backgroundColor:"#1E40AF"},h:"45px",fontSize:"16px",fontWeight:"bold",borderRadius:"12px",mt:"$2",get children(){return m(()=>!!d(),!0)()?t("login.register"):t("login.login")}}),e(z,{w:"$full",justifyContent:"space-between",alignItems:"center",get children(){return[e(l,{get when(){return ee()},get children(){return e(R,{color:"#3573FF",fontSize:"14px",cursor:"pointer",onClick:V,_hover:{textDecoration:"underline",color:"#2B5CD9"},get children(){return m(()=>!!d(),!0)()?t("login.go_login"):t("login.register")}})}}),e(R,{as:"a",onClick:()=>{F(),N(decodeURIComponent(M.redirect||L||"/"),!0)},color:"#3573FF",fontSize:"14px",cursor:"pointer",_hover:{textDecoration:"underline",color:"#2B5CD9"},get children(){return t("login.use_guest")}})]}})]}}),e(k,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(de,{}),e(pe,{}),e(me,{}),e(l,{when:K,get children(){return e(P,{cursor:"pointer",boxSize:"$8",as:he,p:"$0_5",onclick:ne})}})]}})]}})}})]}}),e(ut,{get useNewVersion(){return H()}})]}})};export{mt as default};
